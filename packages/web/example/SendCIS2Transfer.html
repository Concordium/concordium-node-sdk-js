<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title></title>
    <script src="../lib/concordium.min.js"></script>
    <script type="module">
        const client = concordiumSDK.createConcordiumClient("https://grpc.testnet.concordium.com", 20000);

        const send = async function () {
            // The better approach here though, would be to install "@concordium/browser-wallet-api-helpers" and use the supplied `detectConcordiumProvider` function.
            const walletApi = window.concordium;
            if (walletApi === undefined) {
                throw new Error('This example needs the concordium browser wallet to work.');
            }

            const connectedAccount = await walletApi.connect();

            if (connectedAccount === undefined) {
                throw new Error('No account connected in wallet');
            }
            if (index.value === '' || index.value == undefined) {
                throw new Error('Please specify a contract index');
            }
            if (!receiver.value) {
                throw new Error('Specify receiver account');
            }

            const address = {index: BigInt(index.value), subindex: 0n};
            const contract = await concordiumSDK.CIS2Contract.create(client, address);

            const transfer = {tokenId: tokenId.value ?? '', from: connectedAccount, to: receiver.value, tokenAmount: BigInt(amount.value ?? 0)};
            //const transfer = {tokenId: '', from: connectedAccount, to: {address: {index: 4416n, subindex: 0n}, hookName: 'onReceivingCIS2'}, tokenAmount: BigInt(amount.value)}; // Example of using a contract receiver.
            const txHash = await contract.transfer({amount: 0n, energy: 10000n}, transfer, async ({type, payload, parameter: {json}, schema}) => walletApi.sendTransaction(connectedAccount, type, payload, json, schema));

            if (txHash) {
                console.log('Waiting for finalization');
                const blockHash = await client.waitForTransactionFinalization(txHash);
                console.log('Transaction included in block', blockHash);
            }
        };
        document.getElementById('button').onclick = send;
    </script>
</head>

<body>
    Contract index: <input type="number" id="index" />
    <br />
    Token ID: <input type="text" id="tokenId" />
    <br />
    Amount: <input type="number" id="amount" />
    <br />
    Receiver account: <input type="text" id="receiver" />
    <br />
    <button id="button">
        Click
    </button>
    <br />
    <div>
        <label id="result">
    </div>
    <div id="errorBox" hidden={true}>
        Error: <label id="error" />
    </div>
</body>

</html>
