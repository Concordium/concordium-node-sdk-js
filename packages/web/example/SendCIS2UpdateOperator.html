<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title></title>
    <script src="../lib/concordium.min.js"></script>
    <script type="module">
        const client = concordiumSDK.createConcordiumClient("https://grpc.testnet.concordium.com", 20000);

        const send = async function () {
            // The better approach here though, would be to install "@concordium/browser-wallet-api-helpers" and use the supplied `detectConcordiumProvider` function.
            const walletApi = window.concordium;
            if (walletApi === undefined) {
                throw new Error('This example needs the concordium browser wallet to work.');
            }

            const connectedAccount = await walletApi.connect();

            if (connectedAccount === undefined) {
                throw new Error('No account connected in wallet');
            }
            if (index.value === '' || index.value == undefined) {
                throw new Error('Please specify a contract index');
            }
            if (!operator.value) {
                throw new Error('Specify operator account');
            }

            const address = {index: BigInt(index.value), subindex: 0n};
            const contract = await concordiumSDK.CIS2Contract.create(client, address);

            const checkedType = Object.values(type).find(field => field.checked).value;
            const transfer = {type: checkedType, address: operator.value};
            //const transfer = {type: checkedType, address}; // Example with contract address, using same address as used to instantiate the contract class
            const txHash = await contract.updateOperator({amount: 0n, energy: 10000n}, transfer, async ({type, payload, parameter: {json}, schema}) => walletApi.sendTransaction(connectedAccount, type, payload, json, schema));

            if (txHash) {
                const blockHash = client.waitForTransactionFinalization(txHash);
            }
        };
        document.getElementById('button').onclick = send;
    </script>
</head>

<body>
    Contract index: <input type="number" id="index" />
    <br />
    Operator account: <input type="text" id="operator" />
    <br />
    <fieldset style="width: 200px;">
        <legend>
            Update type:
        </legend>
        <input type="radio" name="type" id="type" value="add" checked /> Add
        <br />
        <input type="radio" name="type" id="type" value="remove" /> Remove
        <br />
    </fieldset>
    <br />
    <button id="button">
        Click
    </button>
    <br />
    <div>
        <label id="result">
    </div>
    <div id="errorBox" hidden={true}>
        Error: <label id="error" />
    </div>
</body>

</html>
